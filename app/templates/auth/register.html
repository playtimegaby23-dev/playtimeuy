{% extends "base.html" %}
{% block title %}Registro - PlayTimeUY{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-fuchsia-900 via-purple-900 to-black flex items-center justify-center p-4 sm:p-6">
  <div class="flex flex-col lg:flex-row w-full max-w-6xl rounded-3xl overflow-hidden border border-white/10 shadow-[0_0_60px_rgba(236,72,153,0.4)] animate-fadeIn">

    <!-- Panel Izquierdo -->
    <aside class="hidden lg:flex lg:w-1/2 bg-gradient-to-br from-pink-500 via-fuchsia-500 to-purple-700 items-center justify-center relative overflow-hidden">
      <div class="absolute inset-0 bg-black/40 backdrop-blur-md rounded-l-3xl"></div>
      <div class="z-10 text-center p-8 animate-slideUp">
        <img src="{{ url_for('static', filename='img/Registro.png') }}" alt="Registro PlayTimeUY" class="w-48 xl:w-64 mx-auto mb-6 drop-shadow-[0_0_25px_rgba(255,255,255,0.6)] animate-pulseGlow">
        <h1 class="text-4xl xl:text-5xl font-extrabold text-white tracking-tight">PlayTimeUY</h1>
        <p class="text-base xl:text-lg text-white/90 mt-3 xl:mt-4 max-w-md mx-auto leading-relaxed">
          Tu espacio para mostrarte al mundo y quedarte con el <span class="font-bold text-pink-300">100%</span> de tus ganancias.
        </p>
      </div>
    </aside>

    <!-- Panel Derecho -->
    <section class="flex-1 bg-white/5 backdrop-blur-2xl border-l border-white/20 p-6 sm:p-10 lg:p-12 text-white animate-fadeIn">
      <h2 class="text-3xl sm:text-4xl font-extrabold text-center text-pink-400 mb-4 drop-shadow-lg">Crear cuenta</h2>
      <p class="text-center text-gray-300 mb-8 text-sm sm:text-base">Únete a la plataforma que revoluciona la forma de ganar online</p>

      <!-- Flash messages -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="space-y-3" role="alert" aria-live="polite">
            {% for category, message in messages %}
              {% set styles = {
                'danger': 'bg-red-600/80 text-red-100',
                'warning': 'bg-yellow-600/80 text-yellow-100',
                'success': 'bg-green-600/80 text-green-100',
                'info': 'bg-blue-600/80 text-blue-100'
              } %}
              <div class="px-4 py-3 rounded-lg text-sm font-medium {{ styles.get(category, 'bg-blue-600/80 text-blue-100') }} animate-slideIn">
                {{ message }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <!-- Formulario -->
      <form id="registroForm" method="POST" action="{{ url_for('main.register') }}" class="space-y-6" novalidate>
        {{ form.hidden_tag() }}

        <!-- Honeypot -->
        <input type="text" name="website" id="website" class="hidden" tabindex="-1" autocomplete="off" aria-hidden="true">

        {% for field in [form.username, form.email, form.password, form.confirm_password, form.dob, form.country, form.role] %}
        <div>
          <label for="{{ field.id }}" class="block text-sm text-gray-300 mb-1">{{ field.label.text }}</label>
          <div class="relative">
            {% if field.type == 'PasswordField' %}
              <i class="fas fa-lock absolute top-3 left-4 text-pink-400"></i>
              {{ field(class="input-modern pl-12 pr-12 w-full", placeholder=field.label.text) }}
              <button type="button" class="toggle-pass absolute top-2 right-2 text-gray-400 hover:text-pink-400 transition" data-target="{{ field.id }}" aria-label="Mostrar u ocultar contraseña">
                <i class="far fa-eye"></i>
              </button>
            {% elif field.type == 'StringField' or field.type == 'EmailField' %}
              <i class="fas fa-at absolute top-3 left-4 text-pink-400"></i>
              {{ field(class="input-modern pl-12 w-full", placeholder=field.label.text) }}
            {% else %}
              {{ field(class="input-modern w-full") }}
            {% endif %}
          </div>
          {% if field.errors %}
            <p class="text-red-400 text-xs mt-1">{{ field.errors[0] }}</p>
          {% endif %}
        </div>
        {% endfor %}

        <!-- Términos -->
        <div class="flex items-start gap-3 text-sm text-gray-300">
          {{ form.terms(id="terms", class="mt-1 h-4 w-4 rounded border-white/30 bg-white/10") }}
          <label for="terms">Acepto los <a href="{{ url_for('main.index') }}#terminos" class="underline text-pink-400 hover:text-white">Términos y Condiciones</a>.</label>
        </div>
        {% if form.terms.errors %}
          <p class="text-red-400 text-xs mt-1">{{ form.terms.errors[0] }}</p>
        {% endif %}

        <!-- Botón -->
        <div>
          {{ form.submit(class="btn-3d w-full py-3 text-lg font-bold rounded-2xl tracking-wide flex items-center justify-center gap-2 hover:scale-105 transition-all duration-300") }}
        </div>
      </form>

      <p class="mt-6 text-center text-sm text-gray-300">
        ¿Ya tenés cuenta?
        <a href="{{ url_for('main.login') }}" class="underline text-pink-400 hover:text-white transition">Iniciar sesión</a>
      </p>
    </section>
  </div>
</div>

<!-- JS toggle password y validación básica -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  // Toggle password
  document.querySelectorAll(".toggle-pass").forEach(btn => {
    btn.addEventListener("click", () => {
      const target = document.getElementById(btn.dataset.target);
      if(target) target.type = target.type === "password" ? "text" : "password";
    });
  });

  // Validación simple antes de enviar
  const form = document.getElementById("registroForm");
  form.addEventListener("submit", e => {
    let valid = true;
    form.querySelectorAll("input[required]").forEach(inp => {
      if(!inp.value.trim()) {
        valid = false;
        inp.classList.add("border-red-400");
      } else {
        inp.classList.remove("border-red-400");
      }
    });
    if(!valid) e.preventDefault();
  });
});
</script>

<style>
/* Animaciones */
@keyframes fadeIn { 0% {opacity:0; transform:translateY(10px);} 100% {opacity:1; transform:translateY(0);} }
.animate-fadeIn { animation:fadeIn 0.7s ease-in-out forwards; }

@keyframes slideUp { 0% {opacity:0; transform:translateY(20px);} 100% {opacity:1; transform:translateY(0);} }
.animate-slideUp { animation:slideUp 0.7s ease forwards; }

@keyframes pulseGlow { 0% {box-shadow:0 0 0 rgba(236,72,153,.2);} 100% {box-shadow:0 0 25px rgba(236,72,153,.35);} }
.animate-pulseGlow { animation:pulseGlow 2s ease-in-out infinite alternate; }

/* Inputs modernos */
.input-modern {
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.2);
  padding: 0.75rem 1rem;
  border-radius: 0.75rem;
  transition: all 0.3s;
}
.input-modern:focus {
  border-color: #ec4899;
  background: rgba(236,72,153,0.05);
  outline: none;
  box-shadow: 0 0 8px rgba(236,72,153,0.4);
}

/* Botón 3D */
.btn-3d {
  background: linear-gradient(145deg,#ec4899,#d946ef);
  box-shadow: 0 6px #c026d3;
}
.btn-3d:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px #c026d3;
}
</style>
{% endblock %}
