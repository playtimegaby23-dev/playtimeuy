<nav class="relative backdrop-blur-xl bg-gray-900/80 shadow-2xl sticky top-0 z-50 border-b border-gray-800 overflow-hidden transition-shadow duration-300">
  <!-- Fondo gradiente animado -->
  <div class="absolute inset-0 bg-gradient-to-r from-pink-600 via-purple-700 to-pink-500 opacity-10 animate-gradient-bg pointer-events-none"></div>

  <div class="relative container mx-auto px-6 py-3 flex items-center justify-between">
    <!-- Logo -->
    <a href="{{ url_for('main.index') }}"
       class="text-2xl font-extrabold tracking-tight text-white hover:text-pink-500 transition-all duration-500 flex items-center gap-2 group"
       aria-label="Ir a inicio">
      <span class="inline-block transform group-hover:rotate-12 group-hover:scale-125 transition-transform duration-500">🎯</span>
      PlayTime<span class="text-pink-500">UY</span>
    </a>

    {% set user = session.get('user') %}
    <!-- Menú Desktop -->
    <ul class="hidden md:flex space-x-6 font-medium text-gray-300 items-center relative">
      <!-- Inicio -->
      <li>
        <a href="{{ url_for('main.index') }}"
           class="nav-link relative px-3 py-1 hover:text-pink-500 transition-colors duration-300 {% if request.endpoint == 'main.index' %}text-pink-500{% endif %}">
          Inicio
        </a>
      </li>

      {% if user %}
        <!-- Explorar -->
        <li>
          <a href="{{ url_for('main.dashboard') }}"
             class="nav-link relative px-3 py-1 hover:text-pink-500 transition-colors duration-300 {% if 'dashboard' in request.endpoint %}text-pink-500{% endif %}">
            Explorar
          </a>
        </li>

        <!-- Perfil Dropdown -->
        <li class="relative group" id="dropdown-wrapper">
          <button class="flex items-center gap-2 px-3 py-1 rounded-lg hover:bg-gray-800/70 transition-all duration-300 focus-visible:outline focus-visible:outline-2 focus-visible:outline-pink-500"
                  aria-haspopup="true" aria-expanded="false" id="dropdown-btn">
            <img src="{{ user.avatar or url_for('static', filename='img/avatar-placeholder.png') }}"
                 alt="Avatar de {{ user.username }}" class="w-9 h-9 rounded-full border-2 border-pink-500 shadow-sm">
            <span class="text-white font-medium">{{ user.username }}</span>
            <svg id="dropdown-icon" class="w-4 h-4 text-gray-300 group-hover:text-pink-500 transition-transform duration-300" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>

          <!-- Menú desplegable -->
          <div id="dropdown-menu" class="absolute right-0 mt-2 w-64 bg-gray-800 rounded-lg shadow-xl opacity-0 scale-95 invisible transition-all duration-300 z-50">
            <div class="px-4 py-3 border-b border-gray-700 flex flex-col gap-1">
              <div class="flex items-center justify-between">
                <span class="font-semibold text-white">{{ user.full_name }}</span>
                <span class="text-xs text-gray-400 uppercase">{{ user.role }}</span>
              </div>
            </div>

            <!-- Links del dropdown -->
            <a href="{{ url_for('main.dashboard') }}" class="dropdown-item">Dashboard</a>

            {% for view, label in {
              'main.profile': 'Perfil',
              'main.subscriptions': 'Suscripciones',
              'main.tips': 'Tips',
              'main.settings': 'Configuración'
            }.items() %}
              {% if view in current_app.view_functions %}
                <a href="{{ url_for(view) }}" class="dropdown-item">{{ label }}</a>
              {% endif %}
            {% endfor %}

            <div class="border-t border-gray-700"></div>
            <a href="{{ url_for('main.api_logout') }}" class="dropdown-item text-red-400 hover:bg-gray-700 rounded-b-lg">
              Cerrar sesión
            </a>
          </div>
        </li>
      {% else %}
        <!-- Botón login -->
        <li>
          <a href="{{ url_for('main.login') }}"
             class="btn-primary bg-gradient-to-r from-pink-500 to-purple-500 text-white px-5 py-2 rounded-lg shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-pink-500/50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-pink-500">
            Iniciar sesión
          </a>
        </li>
      {% endif %}
    </ul>
  </div>
</nav>
